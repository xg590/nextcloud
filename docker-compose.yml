version: '3'

services: 
  db:
    container_name: db_container
    image: mariadb
    command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW
    restart: always
    volumes:
      - db_vol:/var/lib/mysql 
    environment:
      - MYSQL_ROOT_PASSWORD=123456
      - MYSQL_DATABASE=dbname
      - MYSQL_USER=username
      - MYSQL_PASSWORD=passwd
    networks:
      - intranet 
 
  nextcloud:
    container_name: nextcloud
    depends_on:
      - db 
    build: ./nextcloud
    restart: always 
    ports: 
      - 443:443
    volumes:   
      - /root/file:/var/www/html/file:ro
      - /etc/letsencrypt/live/Here_should_be_your_domain_name/privkey.pem:/ssl/privkey.pem:ro  
      - /etc/letsencrypt/live/Here_should_be_your_domain_name/fullchain.pem:/ssl/fullchain.pem:ro 
      - data_vol:/var/www/html/nextcloud/data 
    networks:
      - intranet
        
volumes:
  db_vol:   
  data_vol: 
  
networks:
  intranet: 
